{"code":"(()=>{\nvar __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __hasOwnProp=Object.prototype.hasOwnProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:true})};var __copyProps=(to,from,except,desc)=>{if(from&&typeof from===\"object\"||typeof from===\"function\"){for(let key of __getOwnPropNames(from))if(!__hasOwnProp.call(to,key)&&key!==except)__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable})}return to};var __toCommonJS=mod=>__copyProps(__defProp({},\"__esModule\",{value:true}),mod);var util_exports={};__export(util_exports,{HttpError:()=>HttpError,canPrefetch:()=>canPrefetch,catchInvalidSignatureException:()=>catchInvalidSignatureException,clearCache:()=>clearCache,createClient:()=>createClient,createError:()=>createError,createPrefetchClient:()=>createPrefetchClient,getCache:()=>getCache,getInternal:()=>getInternal,jsonSafeParse:()=>jsonSafeParse,jsonSafeStringify:()=>jsonSafeStringify,modifyCache:()=>modifyCache,normalizeHttpResponse:()=>normalizeHttpResponse,processCache:()=>processCache,sanitizeKey:()=>sanitizeKey});module.exports=__toCommonJS(util_exports);const createPrefetchClient=__name(options=>{const{awsClientOptions}=options;const client=new options.AwsClient(awsClientOptions);if(options.awsClientCapture&&options.disablePrefetch){return options.awsClientCapture(client)}else if(options.awsClientCapture){console.warn(\"Unable to apply X-Ray outside of handler invocation scope.\")}return client},\"createPrefetchClient\");const createClient=__name(async(options,request)=>{let awsClientCredentials={};if(options.awsClientAssumeRole){if(!request){throw new Error(\"Request required when assuming role\",{cause:{package:\"@middy/util\"}})}awsClientCredentials=await getInternal({credentials:options.awsClientAssumeRole},request)}awsClientCredentials={...awsClientCredentials,...options.awsClientOptions};return createPrefetchClient({...options,awsClientOptions:awsClientCredentials})},\"createClient\");const canPrefetch=__name((options={})=>{return!options.awsClientAssumeRole&&!options.disablePrefetch},\"canPrefetch\");const getInternal=__name(async(variables,request)=>{if(!variables||!request)return{};let keys=[];let values=[];if(variables===true){keys=values=Object.keys(request.internal)}else if(typeof variables===\"string\"){keys=values=[variables]}else if(Array.isArray(variables)){keys=values=variables}else if(typeof variables===\"object\"){keys=Object.keys(variables);values=Object.values(variables)}const promises=[];for(const internalKey of values){const pathOptionKey=internalKey.split(\".\");const rootOptionKey=pathOptionKey.shift();let valuePromise=request.internal[rootOptionKey];if(!isPromise(valuePromise)){valuePromise=Promise.resolve(valuePromise)}promises.push(valuePromise.then(value=>pathOptionKey.reduce((p,c)=>p?.[c],value)))}values=await Promise.allSettled(promises);const errors=values.filter(res=>res.status===\"rejected\").map(res=>res.reason);if(errors.length){throw new Error(\"Failed to resolve internal values\",{cause:{package:\"@middy/util\",data:errors}})}return keys.reduce((obj,key,index)=>({...obj,[sanitizeKey(key)]:values[index].value}),{})},\"getInternal\");const isPromise=__name(promise=>typeof promise?.then===\"function\",\"isPromise\");const sanitizeKeyPrefixLeadingNumber=/^([0-9])/;const sanitizeKeyRemoveDisallowedChar=/[^a-zA-Z0-9]+/g;const sanitizeKey=__name(key=>{return key.replace(sanitizeKeyPrefixLeadingNumber,\"_$1\").replace(sanitizeKeyRemoveDisallowedChar,\"_\")},\"sanitizeKey\");const cache={};const processCache=__name((options,middlewareFetch=()=>void 0,request)=>{let{cacheKey,cacheKeyExpiry,cacheExpiry}=options;cacheExpiry=cacheKeyExpiry?.[cacheKey]??cacheExpiry;const now=Date.now();if(cacheExpiry){const cached=getCache(cacheKey);const unexpired=cached.expiry&&(cacheExpiry<0||cached.expiry>now);if(unexpired){if(cached.modified){const value2=middlewareFetch(request,cached.value);Object.assign(cached.value,value2);cache[cacheKey]={value:cached.value,expiry:cached.expiry};return cache[cacheKey]}return{...cached,cache:true}}}const value=middlewareFetch(request);const expiry=cacheExpiry>864e5?cacheExpiry:now+cacheExpiry;const duration=cacheExpiry>864e5?cacheExpiry-now:cacheExpiry;if(cacheExpiry){const refresh=duration>0?setTimeout(()=>processCache(options,middlewareFetch,request),duration):void 0;cache[cacheKey]={value,expiry,refresh}}return{value,expiry}},\"processCache\");const catchInvalidSignatureException=__name((e,client,command)=>{if(e.__type===\"InvalidSignatureException\"){return client.send(command)}throw e},\"catchInvalidSignatureException\");const getCache=__name(key=>{if(!cache[key])return{};return cache[key]},\"getCache\");const modifyCache=__name((cacheKey,value)=>{if(!cache[cacheKey])return;clearTimeout(cache[cacheKey]?.refresh);cache[cacheKey]={...cache[cacheKey],value,modified:true}},\"modifyCache\");const clearCache=__name((keys=null)=>{keys=keys??Object.keys(cache);if(!Array.isArray(keys))keys=[keys];for(const cacheKey of keys){clearTimeout(cache[cacheKey]?.refresh);cache[cacheKey]=void 0}},\"clearCache\");const jsonSafeParse=__name((text,reviver)=>{if(typeof text!==\"string\")return text;const firstChar=text[0];if(firstChar!==\"{\"&&firstChar!==\"[\"&&firstChar!=='\"')return text;try{return JSON.parse(text,reviver)}catch(e){}return text},\"jsonSafeParse\");const jsonSafeStringify=__name((value,replacer,space)=>{try{return JSON.stringify(value,replacer,space)}catch(e){}return value},\"jsonSafeStringify\");const normalizeHttpResponse=__name(request=>{let{response}=request;if(typeof response===\"undefined\"){response={}}else if(typeof response?.statusCode===\"undefined\"&&typeof response?.body===\"undefined\"&&typeof response?.headers===\"undefined\"){response={statusCode:200,body:response}}response.statusCode??=500;response.headers??={};request.response=response;return response},\"normalizeHttpResponse\");const createErrorRegexp=/[^a-zA-Z]/g;class HttpError extends Error{static{__name(this,\"HttpError\")}constructor(code,message,options={}){if(message&&typeof message!==\"string\"){options=message;message=void 0}message??=httpErrorCodes[code];super(message,options);const name=httpErrorCodes[code].replace(createErrorRegexp,\"\");this.name=name.substr(-5)!==\"Error\"?name+\"Error\":name;this.status=this.statusCode=code;this.expose=options.expose??code<500}}const createError=__name((code,message,properties={})=>{return new HttpError(code,message,properties)},\"createError\");const httpErrorCodes={100:\"Continue\",101:\"Switching Protocols\",102:\"Processing\",103:\"Early Hints\",200:\"OK\",201:\"Created\",202:\"Accepted\",203:\"Non-Authoritative Information\",204:\"No Content\",205:\"Reset Content\",206:\"Partial Content\",207:\"Multi-Status\",208:\"Already Reported\",226:\"IM Used\",300:\"Multiple Choices\",301:\"Moved Permanently\",302:\"Found\",303:\"See Other\",304:\"Not Modified\",305:\"Use Proxy\",306:\"(Unused)\",307:\"Temporary Redirect\",308:\"Permanent Redirect\",400:\"Bad Request\",401:\"Unauthorized\",402:\"Payment Required\",403:\"Forbidden\",404:\"Not Found\",405:\"Method Not Allowed\",406:\"Not Acceptable\",407:\"Proxy Authentication Required\",408:\"Request Timeout\",409:\"Conflict\",410:\"Gone\",411:\"Length Required\",412:\"Precondition Failed\",413:\"Payload Too Large\",414:\"URI Too Long\",415:\"Unsupported Media Type\",416:\"Range Not Satisfiable\",417:\"Expectation Failed\",418:\"I'm a teapot\",421:\"Misdirected Request\",422:\"Unprocessable Entity\",423:\"Locked\",424:\"Failed Dependency\",425:\"Unordered Collection\",426:\"Upgrade Required\",428:\"Precondition Required\",429:\"Too Many Requests\",431:\"Request Header Fields Too Large\",451:\"Unavailable For Legal Reasons\",500:\"Internal Server Error\",501:\"Not Implemented\",502:\"Bad Gateway\",503:\"Service Unavailable\",504:\"Gateway Timeout\",505:\"HTTP Version Not Supported\",506:\"Variant Also Negotiates\",507:\"Insufficient Storage\",508:\"Loop Detected\",509:\"Bandwidth Limit Exceeded\",510:\"Not Extended\",511:\"Network Authentication Required\"};0&&(module.exports={HttpError,canPrefetch,catchInvalidSignatureException,clearCache,createClient,createError,createPrefetchClient,getCache,getInternal,jsonSafeParse,jsonSafeStringify,modifyCache,normalizeHttpResponse,processCache,sanitizeKey});\n})()\n","warnings":[],"map":{"version":3,"mappings":"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","names":["value"],"ignoreList":[],"sources":["C:\\Users\\uebuk\\Documents\\projects\\e-commerce-api\\user-service\\node_modules\\@middy\\util\\index.js"],"sourcesContent":[null]}}